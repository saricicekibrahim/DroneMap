var app=angular.module("droneApp",[]).controller("droneCtrl",["$scope","$http","$sce",function(e,o,t){var r=document.getElementById("popup"),n=document.getElementById("popup-content"),a=document.getElementById("popup-closer");app.config(function(e){e.resourceUrlWhitelist(["self","https://www.youtube.com/**"])}),e.videoFilter={search:""};var l=new ol.Overlay({element:r,autoPan:!0,autoPanAnimation:{duration:250}});a.onclick=function(){e.closePopup()},e.closePopup=function(){return l.setPosition(void 0),a.blur(),!1},e.searchValue="",e.getIframeSrc=function(e){return t.trustAsResourceUrl("https://www.youtube.com/embed/"+e)},e.map=new ol.Map({interactions:ol.interaction.defaults().extend([new ol.interaction.DragRotateAndZoom]),target:"map",layers:[new ol.layer.Tile({source:new ol.source.OSM})],view:new ol.View({center:ol.proj.transform([32.9,39.9],"EPSG:4326","EPSG:3857"),zoom:10}),overlays:[l]}),e.videoLayer=null,o.get("https://www.googleapis.com/fusiontables/v1/query?sql=SELECT * FROM 1MIt8HjHPRe4_rifTaAwpK72vJ6c-oJdoa5c8Ryd7&key=AIzaSyCrjxOUtz0PEtDh9tDn6sjzObkC9dqQ1oA").then(function(o){e.fusionData=o.data.rows,e.features=[],angular.forEach(e.fusionData,function(o,t){var r=o[1].split(",");e.features.push(new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform([parseFloat(r[1]),parseFloat(r[0])],"EPSG:4326","EPSG:3857")),youtube_id:o[2],descr:o[3]}))}),e.videoMapSource=new ol.source.Vector({features:e.features}),e.videoLayer=new ol.layer.Vector({source:e.videoMapSource,style:new ol.style.Style({image:new ol.style.Icon({src:"img/videoIcon.png"})})}),e.map.addLayer(e.videoLayer),e.map.getView().fit(e.videoLayer.getSource().getExtent(),e.map.getSize())});document.getElementById("popup");e.map.on("click",function(o){var t=e.map.forEachFeatureAtPixel(o.pixel,function(e){return e});if(t){var r=o.coordinate;n.innerHTML=t.get("descr")+"<iframe width='350' height='250' src='https://www.youtube.com/embed/"+t.get("youtube_id")+"' frameborder='0' allowfullscreen></iframe>",l.setPosition(r)}else e.closePopup()})}]);