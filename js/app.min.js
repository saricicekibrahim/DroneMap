var app=angular.module("droneApp",[]).controller("droneCtrl",["$scope","$http",function(n,e){var t=document.getElementById("popup"),o=document.getElementById("popup-content"),a=document.getElementById("popup-closer");n.videoFilter={search:""};var r=new ol.Overlay({element:t,autoPan:!0,autoPanAnimation:{duration:250}});n.filteredMapData,n.filterMap=function(){setTimeout(function(){n.features=[],angular.forEach(n.filteredMapData,function(e,t){n.features.push(new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform(n.getLatLonAsArray(e[0]),"EPSG:4326","EPSG:3857")),youtube_id:e[1],descr:e[2]}))}),n.videoMapSource.clear(),n.videoMapSource.addFeatures(n.features)},2e3)},a.onclick=function(){n.closePopup()},n.closePopup=function(){return o.innerHTML=null,r.setPosition(void 0),a.blur(),!1},n.getIframeSrc=function(e){return"https://www.youtube.com/watch?v="+e},n.view=new ol.View({center:ol.proj.transform([32.9,39.9],"EPSG:4326","EPSG:3857"),zoom:10}),n.map=new ol.Map({interactions:ol.interaction.defaults().extend([new ol.interaction.DragRotateAndZoom]),target:"map",layers:[new ol.layer.Tile({source:new ol.source.Stamen({layer:"terrain"})})],view:n.view,overlays:[r]}),n.screenBigEnough=function(){return 750<$(window).width()},n.videoLayer=null,n.videoMapSource=null,n.features=[],n.mapData=[],new ol.source.Vector({features:null});var u=[];function i(e){return Math.pow(2,-10*e)*Math.sin((e-.075)*(2*Math.PI)/.3)+1}e.get("https://sheets.googleapis.com/v4/spreadsheets/1_2J3C_78i9GGbZNznGZD3OIzBaFGZFv1OBiGcCG5s1U/values/A1:D250?key=AIzaSyBalaFs-lUjr0cck_aGIqI4WQHcCYRZ2FE").then(function(e){n.mapData=e.data.values,u=e.data.values,angular.forEach(n.mapData,function(e,t){n.features.push(new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform(n.getLatLonAsArray(e[0]),"EPSG:4326","EPSG:3857")),youtube_id:e[1],descr:e[2]}))}),n.videoMapSource=new ol.source.Vector({features:n.features}),n.videoLayer=new ol.layer.Vector({source:n.videoMapSource,style:new ol.style.Style({image:new ol.style.Icon({src:"img/videoIcon.png"})})}),n.map.addLayer(n.videoLayer),n.map.getView().fit(n.videoLayer.getSource().getExtent(),n.map.getSize())}),n.zoomToVideo=function(e){n.view.animate({center:ol.proj.fromLonLat(n.getLatLonAsArray(e)),duration:2e3,easing:i})},n.getPopupContent=function(e){return n.screenBigEnough()?e.get("descr")+"<iframe width='350' height='250' src='https://www.youtube.com/embed/"+e.get("youtube_id")+"' frameborder='0' allowfullscreen></iframe>":e.get("descr")+"<br><a href='https://www.youtube.com/watch?v="+e.get("youtube_id")+"' target='_blank'>Click for Video</a>"},n.getLatLonAsArray=function(e){var t=e.split(",");return[parseFloat(t[1]),parseFloat(t[0])]},n.map.on("click",function(e){var t=n.map.forEachFeatureAtPixel(e.pixel,function(e){return e});t?(o.innerHTML=n.getPopupContent(t),r.setPosition(e.coordinate)):n.closePopup()}),n.map.on("moveend",function(e){var t=e.map,o=t.getView().calculateExtent(t.getSize()),a=ol.proj.transform(ol.extent.getBottomLeft(o),"EPSG:3857","EPSG:4326"),r=ol.proj.transform(ol.extent.getTopRight(o),"EPSG:3857","EPSG:4326");n.mapData=[],angular.forEach(u,function(e,t){var o=n.getLatLonAsArray(e[0]);o[0]>a[0]&&o[0]<r[0]&&o[1]>a[1]&&o[1]<r[1]&&n.mapData.push(e)}),n.$apply()})}]);